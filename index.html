<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"> <!--Font-->
</head>
<body>
  
  <!-- Hamburger button (hidden on desktop) -->
  <div id="hamburger" class="hamburger">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>
  
  <nav class="mobile-menu" id="mobile-menu">
    <ul>
      <li><a href="contents/home.html" class="active"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="contents/3dart.html"><i class=""></i>3D Model</a></li>
      <li><a href="contents/blog.html"><i class="fas fa-blog"></i> Blog</a></li>
      <li><a href="contents/about.html"><i class="fas fa-user"></i> About</a></li>
    </ul>
  </nav>
  

  <!-- Left Menu -->
  <nav class="left-menu">
    <ul>
      <li><a href="contents/home.html" class="active"><i class="fas fa-home"></i> &nbsp;Home</a></li>
      <li><a href="contents/3dart.html"><i class=""></i>3D Model</a></li>
      <li><a href="contents/blog.html"><i class="fas fa-pencil-alt"></i> &nbsp;Blog</a></li>
      <li><a href="contents/about.html"><i class="fas fa-user"></i> &nbsp;About</a></li>
    </ul>
  </nav>

  <!-- Right Icons -->
  <div class="right-icons">
    <ul>
      <li><a href="mailto:kashifshart786@gmail.com" title="Email"><i class="fas fa-envelope"></i></a></li>
      <li><a href="https://www.linkedin.com/in/kashif-shaikh-256751229/" title="LinkedIn" target="_blank"><i class="fab fa-linkedin"></i></a></li>
      <li><a href="https://www.youtube.com/channel/UChM5M5j4iJn1slm75QCEqfQ" title="YouTube" target="_blank"><i class="fab fa-youtube"></i></a></li>
      <li><a href="contents/resume.pdf" title="Resume" target="_blank"><i class="fas fa-file-pdf"></i></a></li>
    </ul>
  </div>

  <!-- Dynamic Content -->
  <div class="content" id="content">
    <h1>Loading...</h1>
  </div>

  <!-- Project Content-->
  <div id="overlay" class="overlay">
    <span id="close-overlay" class="close-btn">&times;</span>
    <div class="overlay-inner" id="overlay-content">
      <!-- Project HTML will load here -->
    </div>
  </div>
  
  

<script>
  // (keep your existing consts)
  const content = document.getElementById('content');
  const overlay = document.getElementById('overlay');
  const overlayContent = document.getElementById('overlay-content');
  const closeOverlayBtn = document.getElementById('close-overlay');

  // single close handler (attach once)
  closeOverlayBtn.addEventListener('click', () => {
    overlay.classList.remove('active');
    overlayContent.innerHTML = '';
    document.body.style.overflow = '';
  });
  
  // Select links from both desktop and mobile menus
  const links = document.querySelectorAll('.left-menu a, .mobile-menu a');

  // ------------------- Load Page -------------------
  async function loadPage(url, pushState = true) {
    try {
      const response = await fetch(url);
      const html = await response.text();
      content.innerHTML = html;

      if (pushState) {
        const cleanUrl = url.replace('.html', '');
        history.pushState({ page: url }, '', `?page=${cleanUrl}`);
      }

      attachOverlayEvents();

    } catch (err) {
      console.error('Failed to load page:', err);
      content.innerHTML = '<p style="padding:20px;">Error loading page.</p>';
    }
  }

  // ------------------- Default Page -------------------
  const params = new URLSearchParams(window.location.search);
  const pageParam = params.get('page');
  if (pageParam) {
    const target = pageParam.endsWith('.html') ? pageParam : `${pageParam}.html`;
    loadPage(target, false);
  } else {
    loadPage('contents/home.html', false);
  }

  // ------------------- Handle Clicks -------------------
  links.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();

      links.forEach(l => l.classList.remove('active'));
      link.classList.add('active');

      loadPage(link.getAttribute('href'));

      const mobileMenu = document.querySelector('.mobile-menu');
      if (mobileMenu && window.innerWidth <= 768) {
        mobileMenu.style.display = 'none';
        document.getElementById('hamburger').classList.remove('open');
      }
    });
  });

  // ------------------- Handle Back/Forward -------------------
  window.addEventListener('popstate', e => {
    if (e.state && e.state.page) {
      loadPage(e.state.page, false);
    } else {
      loadPage('contents/home.html', false);
    }
  });

  

// ------------------- Overlay logic -------------------
function attachOverlayEvents() {
  const boxes = content.querySelectorAll('.box');

  boxes.forEach(box => {
    if (box.dataset.overlayAttached === 'true') return;
    box.dataset.overlayAttached = 'true';

    box.addEventListener('click', async (e) => {
      const projectFile = box.getAttribute('href');
      if (!projectFile) return;

      e.preventDefault();

      try {
        const res = await fetch(projectFile);
        const html = await res.text();
        overlayContent.innerHTML = html;
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';

        // ✅ Update the browser URL to reflect the opened project
        const relativePath = projectFile.replace(/^contents\//, '');
        history.pushState({ overlay: true, file: projectFile }, '', `#${relativePath}`);

      } catch (err) {
        console.error('Failed to load project:', err);
      }
    });
  });
}

// ------------------- Close overlay -------------------
closeOverlayBtn.addEventListener('click', () => {
  overlay.classList.remove('active');
  overlayContent.innerHTML = '';
  document.body.style.overflow = '';
  history.pushState({}, '', window.location.pathname); // ✅ remove #hash from URL
});

// ------------------- Auto-open overlay if URL has hash -------------------
window.addEventListener('load', async () => {
  const hash = window.location.hash.slice(1); // remove '#'
  if (hash && hash.startsWith('projects/')) {
    const projectFile = `contents/${hash}`;
    try {
      const res = await fetch(projectFile);
      const html = await res.text();
      overlayContent.innerHTML = html;
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    } catch (err) {
      console.error('Failed to auto-load project:', err);
    }
  }
});



  // ------------------- Hamburger -------------------
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.querySelector('.mobile-menu');

  hamburger.addEventListener('click', () => {
    mobileMenu.style.display = mobileMenu.style.display === 'block' ? 'none' : 'block';
    hamburger.classList.toggle('open');
  });
</script>


  

</body>
</html>
